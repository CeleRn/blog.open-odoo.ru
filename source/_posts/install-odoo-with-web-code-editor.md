---
title: Установка Odoo 8-11 с редактором кода в браузере
banner: /assets/images/favicon.png
shortdesc: >-
  В данной статье я изложу свой личный опыт настройки рабочего окружения для
  разработки модулей в системе Odoo.
---
В данной статье я изложу свой личный опыт по настройке рабочего окружения для разработки модулей в системе Odoo.

## Предпосылки к тому, почему я выбрал именно этот путь.

По роду деятельности я вынужден часто перемещаться между объектами клиентов, а так же работать в разных операционных системах и не на своем компьютере. Был даже случай, когда в ночном клубе, где я сделал учет на Odoo, для работы мне выдали MacBook и у нас не было интернета. (Да такое бывает в 2017 году.). И во всех этих ситуациях мне нужна система в которой я могу вносить правки в код, отлаживать его и в целом работать с полным набором привычных инструментов. Так же, было-бы неплохо, чтобы можно было глянуть в базу данных. Ну и доступ к Git репозиторию тоже не будет лишним. 

Итак, вот список требований который я выдвинул к той системе, которая бы меня устраивала полностью:

* Odoo должна работать в изолированном виртуальном окружении например python virtualenv, Docker или виртуальная машина. Это позволит не думать о том как запустить саму Odoo на нужном компьютере. 
* Редактор кода или IDE должен работать так же на любой декстопной OS (Win\Lin\Mac). В том числе чтобы была возможность подцепиться к работающему экземпляру Odoo. Ну и он должен хотя бы не раздражать своей дубовостью, ну и потреблять не особо конское количество ресурсов
* Клиент базы данных Postgresql в принципе должен уметь тоже самое что и редактор кода, цепляться к базе данных с которой работает Odoo, работать на всех настольных операционных системах, и не быть слишком уж ограниченным по функционалу
* Работа в командной строке для перезапуска Odoo после применных изменений. Приложение так же должна уметь цепляться к работающему экзмпляру Odoo. Ну и при этом запускаться на всех операционках.
* Работа с Git — все тоже самое что и у остальных
* И все это должно, по возможности, умещаться на флешке, чтобы воткнув ее в компьютер я мог поднять рабочее окружение без особых танцев с бубном на любом компьютере, даже если нет доступа к Интернет.
* Возможность работать с удаленным сервером, так же на любом компьютере без потери функционала.

Сформулировав все эти требования — я решил что это набор каких-то взаимоисключающих хотелок. Но в тот момент мне сразу вспомнилась 1C, установочный пакет которой, включает в себя весь необходимый инструментарий. Ёе конечно сложно назвать кросплатформенной, но то что разрабочтик всегда знает то, что он не останется без инструментария — очень серьезный фактор ее популярности (Я так думаю).

Поэтому поиск такого решения стал для меня очень важен.

В общем не буду утомлять своими изысканиями. Это тема наверное отдельной статьи. Ниже пойдет полноценное описание того, как настроить такую систему, которая удовлетворяет почти всем вышеописанным пунктам.

### Решение к которому я пришел:

Odoo работает внутри виртуальной машины VirtualBox. Редактор кода, полноценный терминал и графический клиент для базы данных работают в браузере. А код находится и изменяется уже непосредственно внутри виртуальной машины.

### Выглядит это следующим образом:

![KodeExplorer с Odoo](/assets/images/kodexplorer.png)

![Adminer - компактный клиент к различным базам данных](/assets/images/adminer.png)

![WEB-терминал, в котором можно работать без особых ограничений](/assets/images/terminal.png)

как видите это полноценные и работоспособные инструменты. Поскольку все происходит в браузере, то мне не нужно беспокоится о дополнительном софте. 

* Редактор кода. К нему нет притензий с моей стороны. Работают все нужные мне горячие клавиши, показываются все специальные символы и колонки, есть темы и подсказки. 
* Графический клиент к базе данных. Он тоже не вызывал никаких проблем, к тому же всегда можно поставить официальный PgAdmin4. 
* Терминал - это наимение удобная программа, в целом притензии касаются работы с буфером обмена, в остальном все отлично.

Исталяционный файлы для [VirtualBox](https://www.virtualbox.org) есть для всех настольных операционных систем. Саму виртуальную машину можно просто выгрузить на флешку и таким образом у вас в одном файле есть все необходимое. Вы можете развернуть его везде где есть установленные [VirtualBox](https://www.virtualbox.org), а если его нет, установить самостоятельно. 
Данную систему можно развернуть и на любой другой виртуалке, а то и, подозреваю что, в Docker. Настольный компьютер без браузера — вообще нонсенс.

Кстати данную систему можно применять не только для разработки Odoo, а вообще для всего, на что хватит фантазии.  Лично мной проверена рабоспособность всей системы на виртуальной машине с 256 Мб ОЗУ. Правда там внутри была Odoo 8. 11 версия живет на 1Гб вполне бодро.

## Приступаем к развертыванию этой вундервафли.

Настройки VirtualBox:

1. ОЗУ 1Гб
2. Процессор 1 шт.
3. Сеть — в режиме моста, адрес я оставляю динамический, статику прописать можно в любой момент по желанию
4. ОС — Debian 9 на момент написания статьи.

Остальное — на ваш вкус, да и эти пункты гвоздями не прибиты.

### Установка Odoo

Подробно можно ознакомиться вот [здесь](https://doc.open-odoo.ru/developer/11.0/ru/setup/install.html), там есть документация для версий начиная от 8.

Я расскажу как запустить все версии на Debian 9. 

Выполняем все от root, или от sudo

```bash
wget -O - https://nightly.odoo.com/odoo.key | apt-key add -
echo "deb http://nightly.odoo.com/11.0/nightly/deb/ ./" > /etc/apt/sources.list.d/odoo.list
apt-get update && apt-get install odoo -y
```

Этого достаточно, чтобы пакетный менеджер все установил самостоятельно.

Для установки версий 8, 9 и 10 нам нужно установить пакеты из Debian8. Я делаю это так:

```
wget http://ftp.us.debian.org/debian/pool/main/p/python-support/python-support_1.0.15_all.deb
wget http://ftp.br.debian.org/debian/pool/main/p/python-pypdf/python-pypdf_1.13-2_all.deb
dpkg -i ./python-support_1.0.15_all.deb
dpkg -i ./python-pypdf_1.13-2_all.deb 
```

После этого мы можем в автоматическом режиме установить с помощью пакетного менеджера:

### 8 версия

```bash
wget -O - https://nightly.odoo.com/odoo.key | apt-key add -
echo "deb http://nightly.odoo.com/8.0/nightly/deb/ ./" >> /etc/apt/sources.list
apt-get update && apt-get install odoo
```

### 9 версия

```bash
wget -O - https://nightly.odoo.com/odoo.key | apt-key add -
echo "deb http://nightly.odoo.com/9.0/nightly/deb/ ./" >> /etc/apt/sources.list
apt-get update && apt-get install odoo
```

### 10 версия

```bash
wget -O - https://nightly.odoo.com/odoo.key | apt-key add -
echo "deb http://nightly.odoo.com/10.0/nightly/deb/ ./" >> /etc/apt/sources.list
apt-get update && apt-get install odoo
```

Остальные варианты вы можете прочитать по ссылке, указанной выше.
Итак, Odoo мы установили, теперь можем приступить к установке и настройке пакета, который будет обеспечивать работу терминала в браузере.

## Установка WEB-терминала

Установим пакет

```bash
sudo apt-get install shellinabox -y
```

затем отредактируем файл конфигурации, это нужно для того, чтобы данный сервис мог работать за nginx. Находим строку, указанную ниже

```bash
SHELLINABOX_GROUP="${SHELLINABOX_GROUP:-shellinabox}"
```

и после нее добавляем вот эту:

```bash
SHELLINABOX_ARGS="--localhost-only --disable-ssl"
```

затем обновляем информацию о демонах и перезапускам наш shellinabox

```bash
systemctl daemon-reload
service shellinabox restart
```

У этой программы есть свои особенности и касаются они работы буфера обмена. Если вы нажмете Ctrl+C, то эта комбинация прервет выполнение программы, я, например, так останавливаю работающую Odoo, но и эта же комбинация сохранит выделенный фрагмент в буфер обмена вашего компьютера, не виртуальной машины. Чтобы воспользоваться передачей из буфера обмена компьютера на виртуалку, нужно воспользоваться мышкой. В остальном все работает отлично. 

Если кто знает что-то более удобное в работе, пишите. Я буду очень признателен за подсказку.

### Установка NGINX

Поскольку у нас на виртуальном компьютере будет работать как минимум 3 различных сервера, то нам нужно как-то управлять этим безобразием. Поэтому ставим nginx, который будет слушать 80 порт и разруливать по url доступ к нашим подсистемам.

```bash
wget https://nginx.org/keys/nginx_signing.key
apt-key add nginx_signing.key
echo "deb http://nginx.org/packages/debian/ stretch nginx" > /etc/apt/sources.list.d/nginx.list
echo "deb-src http://nginx.org/packages/debian/ stretch nginx" >> /etc/apt/sources.list.d/nginx.list
apt-get update
apt-get install nginx
rm /etc/nginx/conf.d/default.conf
touch /etc/nginx/conf.d/web-ide.conf
```

в файл /etc/nginx/conf.d/web-ide.conf добавляем следующее содержимое:

```bash
server {
	listen 80 default_server;
	listen \[::]:80 default_server;
	# server_name _ default_server;
	root /home/www-data/;
	index index.php;
	
	location /terminal/ {
		proxy_pass http://127.0.0.1:4200;
	}
	location /kodexplorer/ {
			root /home/www-data/;
			index index.php;
	}
	location ~ .php$ {
		try_files $uri =404;
		fastcgi_split_path_info ^(.+.php)(.*)$;
		fastcgi_pass unix:/run/php/php7.0-fpm.sock;
		fastcgi_index index.php;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
		include fastcgi_params;
		fastcgi_ignore_client_abort on;
		fastcgi_param SERVER_NAME $http_host;
	}
	location / {
		proxy_pass http://127.0.0.1:8069;
		proxy_redirect off;
		# Add Headers for odoo proxy mode
		proxy_set_header X-Forwarded-Host $host;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
		proxy_set_header X-Real-IP $remote_addr;
	}
	
	location /longpolling {
		proxy_pass http://127.0.0.1:8069;
	}
}
```

Сохраняем файл и перезапускаем сервер

```bash
service nginx restart
```

### Настройка рабочего пространства

Для того, чтобы нам было удобно работать с кодом, нам нужно создать каталоги таким образом, чтобы было удобно создавать проекты, работать с модулями Odoo и Git. Здесь я предлагаю свое решение, оно не идеально, но на данном этапе моего развития не раздражает, хотя я уже вижу то, что можно было бы поправить. 
Для начала мы создадим каталог, в который будет иметь доступ группа www-data (поскольку у нас все основано на web, то как бы логично использовать штатную для такого рода вещей группу)

```bash
usermod -a -G www-data nginx
usermod -a -G www-data odoo
```

Дальше вы можете разрешить пользователю www-data логиниться и работать от его имени. В файле
```bash
/etc/passwd  поменять /usr/sbin/nologin на /bin/bash
```
 или создать для этих нужд отдельного пользователя. Все зависит от ваших предпочтений по безопасности. Я использую систему от своего пользователя, и буду этот пример использовать в дальнейшем.
Теперь создадим каталог

```bash
mkdir /home/www-data
```

Это будет корневой каталог, в котором будут располагаться проекты, ссылка на стандартные модули Odoo, чтобы можно было подсматривать в готовый код, ну и сам редактор кода.

Файловая структура будет выглядеть вот таким образом.

```bash
/home/www-data
|
|-- kodexplorer
|   |-- ...
|   |-- …
|
|-- ~odoo_addons_symlink
|
`-- projects
	|
	|-- project_1
	|	|
	|	|-- odoo_modules
	|	|
	|	|--my_odoo_module
	|	|	|
	|	|`--...
	|	|
	|	|-- some_project_dir
	|	|
	|	|-- some_project_file.fml
	|	|
	|	`-- project_odoo_config_file.conf
	|`-- restart_odoo.sh
```

В каталоге projects будут находится папки с проектами, внутри проекта должен быть обязательный каталог odoo_modules и файл конфигурации Odoo с расширением conf. Скрипт для перезапуска Odoo будет одинаковый для всех, а все необходимые параметры мы будетм передавать через командную строку.
Вот содержимео файла restart_odoo.sh

```bash
service odoo stop
killall -9 python
sudo -u odoo /usr/bin/python /usr/bin/odoo -u $2 -d $1 -i $2 -c /home/www-data/projects/$1/project_odoo_config_file.conf
```

Для того, чтобы запустить этот скрипт, я добавляю в sudoers пользователя, от имени которого работаю в терминале, предварительно установив пакет sudo

```bash
apt-get install sudo
```

```bash
echo "имя_вашего_пользователя ALL=(ALL) NOPASSWD: /home/www-data/projects/restart_odoo.sh" >> /etc/sudoers
```



Что-же у меня в файле конфигурации:

```bash
[options]
addons_path = /home/www-data/projects/имя_вашего_проекта/odoo_modules
db_user = odoo
db_password =  ваш_пароль
```
Если вам нужны какие-то подробности по использованию параметров командной строки или файла конфигурации, то [здесь есть подробная информация](https://doc.open-odoo.ru/developer/11.0/ru/reference/cmdline.html)

Все, чисто теоретически, больше ничего не нужно для данного решения.
Для перезапуска Odoo и обновления всех модуля, который и разрабатываю я запускаю вот такую команду:

```bash
sudo /home/www-data/projects/restart_odoo.sh имя_проекс_оноже_имя_базы имя_модуля
```
После этого мы увидим как сервер Odoo запустится в нашем сеансе терминала и сможем спокойно заниматься отладкой, если что-то пошло не так, а так же видеть об какие файлы и их фрагменты спотыкается система при допущенных ошибках.


### Установка KodExplorer (редактор кода и не только)

Нужно установить php-fpm.

```bash
apt-get -y install php-fpm php-curl php-gd php-pgsql php-mbstring
```

Скачаем архив, и расположим, его в нужном каталоге.

```bash
wget https://github.com/kalcaddle/KODExplorer/archive/master.zip
unzip master.zip -d /home/www-data
mv /home/www-data/KodExplorer* /home/www-data/kodexplorer
chown www-data:www-data -R /home/www-data
chmod 777 -R /home/www-data
service nginx restart
```

Теперь вы можете вот по этим ссылкам найти все нужные инструменты:

`http://ip_вашей_виртуалки` — по этой ссылке откроется Odoo
`http://ip_вашей_виртуалки:8069` — по этой ссылке так-же откроется Odoo

`http://ip_вашей_виртуалки/terminal` — это терминал, который работает в бразуере

`http://ip_вашей_виртуалки/kodexplorer` — это целый комбайн, который работает в бразуере. Здесь есть файловый менеджер, где вы можете заливать файлы в проект простым перетаскиванием, и прочие обычные штуки, только в браузере на удаленном компьютере. Это так же редактор кода и в плагинах есть Adminer, который представляет собой отличную админку базы Postgresql и не только.

Для того, чтобы у вас работал вход через Adminer нужно указывать в качестве адреса 127.0.0.1 (localhost может не работать, ввиду того, что он и для ipV6 тоже служит служебным именем), а так же нужно установить для пользователя odoo свой пароль, который вы должны прописать в файл конфигурации при запуске через скрипт.

```bash
sudo su postgres
psql
ALTER USER odoo WITH PASSWORD 'ваш_пароль'
/q
```
